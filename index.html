<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareerBridge - Your Career Journey Starts Here</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* bg-slate-900 */
        }

        /* --- Professional Preloader Styles --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0f172a;
            z-index: 10000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
            transition: opacity 0.75s ease-out, visibility 0.75s ease-out;
            visibility: visible;
        }

        #preloader.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loader-content {
            text-align: center;
        }

        .loader-content .gradient-text {
            animation: pulse-glow 2.5s ease-in-out infinite;
        }

        .progress-bar-container {
            height: 5px;
            width: 220px;
            background-color: rgba(102, 126, 234, 0.15);
            border-radius: 4px;
            margin: 1rem auto 0;
            overflow: hidden;
        }

        .progress-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #a7b2f5, #764ba2);
            transform: translateX(-100%);
            animation: loading-progress 2s ease-in-out infinite;
            border-radius: 4px;
        }
        
        @keyframes loading-progress {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(0%); }
            100% { transform: translateX(100%); }
        }

        @keyframes pulse-glow {
            0%, 100% {
                text-shadow: 0 0 10px rgba(167, 178, 245, 0.2), 0 0 20px rgba(167, 178, 245, 0.1);
            }
            50% {
                text-shadow: 0 0 20px rgba(167, 178, 245, 0.5), 0 0 35px rgba(167, 178, 245, 0.3);
            }
        }


        /* --- Scroll Animation Styles --- */
        .reveal-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transition-delay: 0.1s;
        }

        .reveal-on-scroll.is-visible {
            opacity: 1;
            transform: translateY(0);
        }


        /* --- Globe Container Styles --- */
        #globe-container {
            position: relative;
            min-height: 100vh;
            display: flex;
            align-items: center;
            overflow: hidden;
            background-color: #020617; /* bg-slate-950 */
        }

        #globe-container canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .job-card {
            background: #1e293b; 
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .job-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .job-card:hover::before {
            transform: translateX(0);
        }

        .job-card:hover {
            transform: translateY(-12px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1; 
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #764ba2 0%, #f093fb 100%);
            transition: left 0.5s ease;
            z-index: -1;
        }

        .btn-primary:hover::before {
            left: 0;
        }
        
        .nav-blur {
            backdrop-filter: blur(20px);
            background: rgba(15, 23, 42, 0.7); 
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-input {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            background: rgb(30, 41, 59);
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }

        .gradient-text {
            background: linear-gradient(135deg, #a7b2f5 0%, #cda3f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .step-card {
            background-color: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            padding: 2rem;
        }
        .step-number {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: 900;
            color: white;
            border: 4px solid #0f172a;
        }
        
        .toolkit-card {
            background: linear-gradient(145deg, #1e293b, #28354c);
             border: 1px solid rgba(255, 255, 255, 0.1);
             transition: all 0.3s ease;
        }
        .toolkit-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-color: #a7b2f5;
        }
        
        .category-card {
            background-color: #1e293b;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .category-card:hover {
            transform: translateY(-8px);
            background-color: #334155;
            border-color: #667eea;
        }

    </style>
</head>

<body>
    <div id="preloader">
        <div class="loader-content">
            <h1 class="text-4xl font-black gradient-text">CareerBridge</h1>
            <div class="progress-bar-container">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>
    
    <nav class="fixed top-0 left-0 right-0 z-50 nav-blur">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <a href="index.html" class="text-2xl font-black gradient-text">CareerBridge</a>
                </div>
                <div class="hidden md:block">
                    <div id="nav-links" class="flex items-center space-x-8"></div>
                </div>
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg text-slate-400 hover:bg-slate-700">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <section id="globe-container">
        <div class="hero-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
            <div class="grid lg:grid-cols-2 gap-12 items-center">
                <div class="text-white reveal-on-scroll">
                    <h1 class="text-5xl lg:text-6xl xl:text-7xl font-black leading-tight mb-6">
                        Find Your
                        <span class="block text-transparent bg-clip-text bg-gradient-to-r from-indigo-300 to-purple-300">
                            Next Opportunity
                        </span>
                        Today
                    </h1>
                    <p class="text-xl text-slate-300 mb-8 max-w-lg leading-relaxed">
                        Connect with top employers across India. From startups to Fortune 500 companies,
                        your perfect opportunity is just a click away.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-4">
                        <a href="frontend/jobs.html" class="protected-link"> <button
                                class="btn-primary px-8 py-4 rounded-full font-bold text-lg w-full sm:w-auto">
                                <i class="fas fa-search mr-2"></i>
                                Explore Jobs
                            </button></a>
                    </div>
                </div>
                <div class="glass-card rounded-3xl p-8 shadow-2xl reveal-on-scroll">
                    <h2 class="text-2xl font-bold text-slate-100 mb-6 text-center">
                        Start Your Job Search
                    </h2>
                    <div class="space-y-4">
                        <div class="relative"><label class="block text-sm font-semibold text-slate-300 mb-2">Job title, keyword...</label><div class="relative"><i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400"></i><input type="text" id="hero-keyword" placeholder="e.g., Software Engineer" class="search-input w-full pl-12 pr-4 py-4 rounded-2xl text-slate-100 placeholder-slate-500 outline-none text-white"></div></div>
                        <div class="relative"><label class="block text-sm font-semibold text-slate-300 mb-2">Location</label><div class="relative"><i class="fas fa-map-marker-alt absolute left-4 top-1/2 transform -translate-y-1/2 text-slate-400"></i><input type="text" id="hero-location" placeholder="City, state, or remote" class="search-input w-full pl-12 pr-4 py-4 rounded-2xl text-slate-100 placeholder-slate-500 outline-none text-white"></div></div>
                        <button id="hero-search-btn" class="btn-primary w-full py-4 rounded-2xl font-bold text-lg text-white relative z-10"><i class="fas fa-rocket mr-2"></i>Find My Dream Job</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="py-20 bg-slate-950 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16"><h2 class="text-4xl font-black text-slate-100 mb-4">Your Journey to a New Job in <span class="gradient-text">3 Simple Steps</span></h2><p class="text-xl text-slate-400 max-w-2xl mx-auto">We've simplified the job search process to be fast, easy, and effective.</p></div>
            <div class="grid md:grid-cols-3 gap-8 md:gap-12 mt-20">
                <div class="step-card rounded-2xl reveal-on-scroll"><div class="step-number">1</div><div class="pt-8"><h3 class="text-2xl font-bold text-slate-100 mb-3">Create Your Profile</h3><p class="text-slate-400">Sign up and build a standout profile in minutes. Highlight your skills, experience, and what makes you unique.</p></div></div>
                <div class="step-card rounded-2xl reveal-on-scroll"><div class="step-number">2</div><div class="pt-8"><h3 class="text-2xl font-bold text-slate-100 mb-3">Discover Opportunities</h3><p class="text-slate-400">Use our powerful search and AI-matching to find jobs that are a perfect fit for your career goals.</p></div></div>
                <div class="step-card rounded-2xl reveal-on-scroll"><div class="step-number">3</div><div class="pt-8"><h3 class="text-2xl font-bold text-slate-100 mb-3">Apply & Get Hired</h3><p class="text-slate-400">Apply to your dream jobs with a single click and get connected directly with top employers in India.</p></div></div>
            </div>
        </div>
    </section>
    
    <section class="py-20 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16"><h2 class="text-4xl font-black text-slate-100 mb-4">Your Career <span class="gradient-text">Success Toolkit</span></h2><p class="text-xl text-slate-400 max-w-3xl mx-auto">We provide more than just job listings. Access expert resources to excel at every stage of your job search.</p></div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="toolkit-card p-8 rounded-2xl reveal-on-scroll"><div class="w-16 h-16 mb-6 rounded-xl bg-slate-800 flex items-center justify-center"><i class="fas fa-file-alt text-3xl text-indigo-400"></i></div><h3 class="text-2xl font-bold text-slate-100 mb-4">Resume Building</h3><p class="text-slate-400 leading-relaxed mb-6">Learn how to craft a compelling resume that grabs the attention of recruiters and passes through automated screening systems (ATS).</p><a href="frontend/resources.html" class="font-semibold text-indigo-400 hover:text-indigo-300">Get Resume Tips <i class="fas fa-arrow-right ml-1"></i></a></div>
                <div class="toolkit-card p-8 rounded-2xl reveal-on-scroll"><div class="w-16 h-16 mb-6 rounded-xl bg-slate-800 flex items-center justify-center"><i class="fas fa-comments text-3xl text-indigo-400"></i></div><h3 class="text-2xl font-bold text-slate-100 mb-4">Interview Prep</h3><p class="text-slate-400 leading-relaxed mb-6">Walk into your next interview with confidence. Get tips on common questions, salary negotiation, and making a great impression.</p><a href="frontend/resources.html" class="font-semibold text-indigo-400 hover:text-indigo-300">Prepare for Interviews <i class="fas fa-arrow-right ml-1"></i></a></div>
                <div class="toolkit-card p-8 rounded-2xl reveal-on-scroll"><div class="w-16 h-16 mb-6 rounded-xl bg-slate-800 flex items-center justify-center"><i class="fas fa-lightbulb text-3xl text-indigo-400"></i></div><h3 class="text-2xl font-bold text-slate-100 mb-4">Career Growth</h3><p class="text-slate-400 leading-relaxed mb-6">Explore articles and guides on upskilling, personal branding, and navigating your career path for long-term success.</p><a href="frontend/resources.html" class="font-semibold text-indigo-400 hover:text-indigo-300">Grow Your Career <i class="fas fa-arrow-right ml-1"></i></a></div>
            </div>
        </div>
    </section>

    <section id="latest-jobs" class="py-20 bg-slate-950 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center mb-12"><div><h2 class="text-4xl font-black text-slate-100 mb-2">Latest Opportunities</h2><p class="text-slate-400">Fresh jobs added daily from top companies.</p></div><a href="frontend/jobs.html" class="protected-link hidden md:block btn-primary px-6 py-3 rounded-full font-semibold text-white"><span>View All Jobs <i class="fas fa-arrow-right ml-2"></i></span></a></div>
            <div id="job-listings-container" class="grid md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
            <div class="text-center mt-12 md:hidden"><a href="frontend/jobs.html" class="protected-link btn-primary px-8 py-4 rounded-full font-semibold text-white">View All Jobs <i class="fas fa-arrow-right ml-2"></i></a></div>
        </div>
    </section>

    <section class="py-20 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16"><h2 class="text-4xl font-black text-slate-100 mb-4">Browse by <span class="gradient-text">Category</span></h2><p class="text-xl text-slate-400 max-w-2xl mx-auto">Explore jobs in the fields that excite you the most.</p></div>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <a href="frontend/jobs.html?keyword=IT%20%26%20Software" class="category-card p-6 rounded-2xl text-center reveal-on-scroll"><i class="fas fa-laptop-code text-4xl text-indigo-400 mb-4"></i><h3 class="font-bold text-lg text-slate-100">IT & Software</h3></a>
                <a href="frontend/jobs.html?keyword=Marketing" class="category-card p-6 rounded-2xl text-center reveal-on-scroll"><i class="fas fa-bullhorn text-4xl text-indigo-400 mb-4"></i><h3 class="font-bold text-lg text-slate-100">Marketing</h3></a>
                <a href="frontend/jobs.html?keyword=Design" class="category-card p-6 rounded-2xl text-center reveal-on-scroll"><i class="fas fa-palette text-4xl text-indigo-400 mb-4"></i><h3 class="font-bold text-lg text-slate-100">Design</h3></a>
                <a href="frontend/jobs.html?keyword=Human%20Resources" class="category-card p-6 rounded-2xl text-center reveal-on-scroll"><i class="fas fa-users text-4xl text-indigo-400 mb-4"></i><h3 class="font-bold text-lg text-slate-100">Human Resources</h3></a>
            </div>
        </div>
    </section>
    
    <footer class="bg-slate-950 text-white border-t border-slate-800 reveal-on-scroll">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-10">
                <div class="lg:col-span-1 reveal-on-scroll"><a href="index.html" class="text-2xl font-black gradient-text mb-4 inline-block">CareerBridge</a><p class="text-slate-400 text-sm">Your career growth partner, connecting talent with opportunity across India.</p></div>
                <div class="reveal-on-scroll"><h4 class="font-bold text-slate-100 mb-4 tracking-wider">Quick Links</h4><ul class="space-y-3"><li><a href="frontend/about.html" class="text-slate-400 hover:text-white transition-colors">About Us</a></li><li><a href="frontend/jobs.html" class="protected-link text-slate-400 hover:text-white transition-colors">Jobs</a></li><li><a href="frontend/resources.html" class="text-slate-400 hover:text-white transition-colors">Resources</a></li></ul></div>
                <div class="reveal-on-scroll"><h4 class="font-bold text-slate-100 mb-4 tracking-wider">Legal</h4><ul class="space-y-3"><li><a href="#" class="text-slate-400 hover:text-white transition-colors">Privacy Policy</a></li><li><a href="#" class="text-slate-400 hover:text-white transition-colors">Terms of Service</a></li><li><a href="#" class="text-slate-400 hover:text-white transition-colors">Contact</a></li></ul></div>
                <div class="reveal-on-scroll"><h4 class="font-bold text-slate-100 mb-4 tracking-wider">Connect With Us</h4><div class="flex space-x-5"><a href="#" aria-label="Twitter" class="text-slate-400 hover:text-white text-xl transition-colors"><i class="fab fa-twitter"></i></a><a href="#" aria-label="LinkedIn" class="text-slate-400 hover:text-white text-xl transition-colors"><i class="fab fa-linkedin-in"></i></a><a href="#" aria-label="GitHub" class="text-slate-400 hover:text-white text-xl transition-colors"><i class="fab fa-github"></i></a><a href="#" aria-label="Instagram" class="text-slate-400 hover:text-white text-xl transition-colors"><i class="fab fa-instagram"></i></a></div></div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-center text-slate-500 reveal-on-scroll"><p>&copy; 2025 CareerBridge. All rights reserved.</p></div>
        </div>
    </footer>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let isUserLoggedIn = false;
        const navLinksContainer = document.getElementById('nav-links');
        const preloader = document.getElementById('preloader');
        window.addEventListener('load', () => { preloader.classList.add('hidden'); });

        const revealObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target);
                }
            });
        }, { root: null, threshold: 0.1 });
        document.querySelectorAll('.reveal-on-scroll').forEach(el => { revealObserver.observe(el); });

        function initGlobe() {
            const container = document.getElementById('globe-container');
            if (!container) return;
            let mouseX = 0; let mouseY = 0;
            const windowHalfX = window.innerWidth / 2; const windowHalfY = window.innerHeight / 2;
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 2.5;
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);
            const particles = new THREE.Points(new THREE.SphereGeometry(1, 40, 40), new THREE.PointsMaterial({ size: 0.008, color: 0x667eea, transparent: true, opacity: 0.8 }));
            scene.add(particles);
            const particles2 = new THREE.Points(new THREE.SphereGeometry(1.2, 40, 40), new THREE.PointsMaterial({ size: 0.005, color: 0x764ba2, transparent: true, opacity: 0.6 }));
            scene.add(particles2);
            const wireframe = new THREE.LineSegments(new THREE.WireframeGeometry(new THREE.SphereGeometry(1.1, 20, 20)), new THREE.LineBasicMaterial({ color: 0x764ba2, transparent: true, opacity: 0.15 }));
            scene.add(wireframe);

            let lastExplosionTime = 0;
            const explosionInterval = 60000;
            const explosionDuration = 60000;
            let isExploding = false;

            document.addEventListener('mousemove', onDocumentMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);

            function onWindowResize() { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); }
            function onDocumentMouseMove(event) { mouseX = (event.clientX - windowHalfX) / 1000; mouseY = (event.clientY - windowHalfY) / 1000; }

            function animate() {
                requestAnimationFrame(animate);
                const now = Date.now();
                if (!isExploding && now - lastExplosionTime > explosionInterval) { isExploding = true; lastExplosionTime = now; }
                if (isExploding) {
                    const elapsedTime = now - lastExplosionTime;
                    const progress = elapsedTime / explosionDuration;
                    if (progress < 1) {
                        const scaleFactor = 1 + Math.sin(progress * Math.PI) * 0.3;
                        particles.scale.set(scaleFactor, scaleFactor, scaleFactor);
                        particles2.scale.set(scaleFactor, scaleFactor, scaleFactor);
                        wireframe.scale.set(scaleFactor, scaleFactor, scaleFactor);
                    } else { isExploding = false; particles.scale.set(1, 1, 1); particles2.scale.set(1, 1, 1); wireframe.scale.set(1, 1, 1); }
                }
                particles.rotation.y += 0.0005 + mouseX * 0.005;
                particles.rotation.x += mouseY * 0.005;
                particles2.rotation.y -= 0.0007 + mouseX * 0.0007;
                particles2.rotation.x -= mouseY * 0.0007;
                wireframe.rotation.y += 0.0003;
                wireframe.rotation.x -= 0.0004;
                renderer.render(scene, camera);
            }
            animate();
        }
        
        async function updateAuthState() {
            try {
                // Set basic navigation links
                navLinksContainer.innerHTML = `<a href="frontend/jobs.html" class="protected-link text-slate-400 hover:text-white font-medium transition-colors">Jobs</a><a href="frontend/resources.html" class="text-slate-400 hover:text-white font-medium transition-colors">Resources</a><a href="frontend/about.html" class="text-slate-400 hover:text-white font-medium transition-colors">About</a>`;
                
                // Fetch auth state with proper credentials
                const response = await fetch(`backend/check_auth.php`, {
                    method: 'GET',
                    credentials: 'same-origin',
                    headers: {
                        'Cache-Control': 'no-cache',
                        'Pragma': 'no-cache'
                    },
                    cache: 'no-store'
                });
                
                if (!response.ok) {
                    console.error('Auth check failed:', response.status, response.statusText);
                    throw new Error('Network response was not ok');
                }
                
                const authData = await response.json();
                
                if (!authData.success) {
                    throw new Error(authData.error || 'Authentication check failed');
                }
                
                isUserLoggedIn = authData.loggedin;

                if (isUserLoggedIn) {
                    const isEmployer = authData.roles && authData.roles.includes('employer');
                    const isAdmin = authData.roles && authData.roles.includes('admin');
                    const profileLink = isEmployer ? 'employer_profile.html' : 'profile.html';

                    if (isEmployer) {
                        navLinksContainer.innerHTML += `<a href="frontend/components/post-Job.html" class="text-slate-400 hover:text-white font-medium transition-colors">Post Job</a>`;
                    }
                    
                    if (isAdmin) {
                        navLinksContainer.innerHTML += `<a href="frontend/admin/dashboard.html" class="text-yellow-400 hover:text-yellow-300 font-medium transition-colors"><i class="fas fa-crown mr-1"></i>Admin</a>`;
                    }
                    
                    const profileDropdownHTML = `
                        <div class="relative" id="profile-menu-container">
                            <button id="profile-menu-button" class="flex items-center focus:outline-none">
                                <img src="https://img.icons8.com/?size=100&id=7819&format=png&color=ffffff" alt="User Avatar" class="w-10 h-10 rounded-full border-2 border-transparent hover:border-indigo-400 transition-colors">
                            </button>
                            <div id="profile-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-slate-800 rounded-lg shadow-xl z-50 ring-1 ring-black ring-opacity-5">
                                <div class="py-1">
                                    <a href="frontend/${profileLink}" class="protected-link block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700">My Profile</a>
                                    <a href="backend/logout_handler.php" class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-700">Logout</a>
                                </div>
                            </div>
                        </div>`;

                    navLinksContainer.insertAdjacentHTML('beforeend', profileDropdownHTML);
                    addDropdownListeners();
                } else {
                    navLinksContainer.insertAdjacentHTML('beforeend', `
                        <a href="frontend/components/signUp.html" class="font-semibold text-slate-300 hover:text-white">Login</a>`);
                }
            } catch (error) {
                console.error("Auth check failed:", error);
                isUserLoggedIn = false;
                navLinksContainer.insertAdjacentHTML('beforeend', `<a href="frontend/components/signUp.html" class="font-semibold text-slate-300 hover:text-white">Login</a>`);
            }
            protectLinks();
        }

        function addDropdownListeners() {
            const menuButton = document.getElementById('profile-menu-button');
            const dropdown = document.getElementById('profile-dropdown');
            const container = document.getElementById('profile-menu-container');
            
            if (!menuButton || !dropdown || !container) return;
            
            // Toggle dropdown on button click
            menuButton.addEventListener('click', (e) => {
                e.stopPropagation();
                dropdown.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!container.contains(e.target)) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // Close dropdown on ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.classList.add('hidden');
                }
            });
            
            // Prevent clicks inside dropdown from closing it
            dropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }
        
        function protectLinks() {
            document.querySelectorAll('.protected-link').forEach(link => {
                const newLink = link.cloneNode(true);
                link.parentNode.replaceChild(newLink, link);
                newLink.addEventListener('click', (event) => {
                    if (!isUserLoggedIn) {
                        event.preventDefault();
                        window.location.href = 'frontend/components/signUp.html';
                    }
                });
            });
        }
        
        async function renderLatestJobs() {
            const listingsContainer = document.getElementById('job-listings-container');
            if (!listingsContainer) return;
            listingsContainer.innerHTML = '<p class="text-slate-400 col-span-4 text-center">Loading latest jobs...</p>';
            try {
                const response = await fetch('backend/get_jobs.php?limit=4');
                const jobs = await response.json();
                listingsContainer.innerHTML = '';
                if (!jobs || jobs.length === 0) {
                    listingsContainer.innerHTML = '<p class="text-slate-400 col-span-4 text-center">No jobs found at the moment.</p>';
                    return;
                }
                jobs.forEach(job => {
                    const companyInitial = job.company ? job.company.charAt(0).toUpperCase() : 'J';
                    const placeholderColors = ['667eea', '764ba2', '34d399', 'fbbf24', 'f87171', '60a5fa'];
                    const randomColor = placeholderColors[job.id % placeholderColors.length];
                    const placeholder = `https://placehold.co/100x100/${randomColor}/ffffff?text=${companyInitial}&font=inter`;
                    let logoSrc = placeholder;

                    if (job.logo && typeof job.logo === 'string' && job.logo.trim() !== '') {
                        const raw = job.logo.trim();
                        if (/^https?:\/\//i.test(raw) || raw.startsWith('/')) {
                            logoSrc = raw;
                        } else {
                            // Clean leading ../ or ./ segments then use basename within expected uploads folder
                            const cleaned = raw.replace(/^(\.+\/)+/, '').replace(/^\//, '');
                            const basename = cleaned.split('/').pop();
                            // Prefer the standard uploads location under frontend/uploads
                            logoSrc = `frontend/uploads/${basename}`;
                        }
                    }

                    const salary = job.salary || 'Not Disclosed';
                    const jobCard = `
                    <div class="job-card p-6 reveal-on-scroll">
                        <div class="flex items-start space-x-4 mb-4">
                            <img src="${logoSrc}" alt="${job.company}" class="w-12 h-12 rounded-xl object-cover shadow-md bg-slate-800" onerror="this.onerror=null;this.src='${placeholder}';">
                            <div class="flex-1 min-w-0">
                                <h3 class="font-bold text-slate-100 text-lg mb-1 truncate">${job.title}</h3>
                                <p class="text-slate-400 text-sm truncate">${job.company}</p>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm text-slate-400">
                            <div class="flex items-center"><i class="fas fa-map-marker-alt w-4 mr-2 text-slate-500"></i><span>${job.location}</span></div>
                            <div class="flex items-center"><i class="fas fa-wallet w-4 mr-2 text-slate-500"></i><span class="font-semibold text-slate-300">${salary}</span></div>
                        </div>
                        <div class="mt-6 pt-4 border-t border-slate-700">
                            <a href="frontend/components/job-detail.html?id=${job.id}" class="protected-link text-indigo-400 hover:text-indigo-300 font-semibold text-sm">
                                View Details <i class="fas fa-arrow-right ml-1"></i>
                            </a>
                        </div>
                    </div>`;
                    listingsContainer.insertAdjacentHTML('beforeend', jobCard);
                });
                
                 document.querySelectorAll('#job-listings-container .reveal-on-scroll').forEach(el => {
                    revealObserver.observe(el);
                });

                protectLinks();
            } catch (error) {
                console.error('Failed to fetch jobs:', error);
                listingsContainer.innerHTML = '<p class="text-red-500 col-span-4 text-center">Could not load jobs.</p>';
            }
        }
        
        function handleHeroSearch() {
            const keyword = document.getElementById('hero-keyword').value;
            const location = document.getElementById('hero-location').value;
            if (!isUserLoggedIn) {
                window.location.href = 'frontend/components/signUp.html';
            } else {
                window.location.href = `frontend/jobs.html?keyword=${encodeURIComponent(keyword)}&location=${encodeURIComponent(location)}`;
            }
        }

        initGlobe(); 
        updateAuthState();
        renderLatestJobs();
        document.getElementById('hero-search-btn').addEventListener('click', handleHeroSearch);
    });
    </script>
</body>

</html>